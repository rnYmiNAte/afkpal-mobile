name: AFKPal Cloud Phone Auto Mode Selector

on:
  workflow_dispatch:

jobs:
  auto-mode:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set up ADB
        run: |
          sudo apt-get update
          sudo apt-get install -y adb bc

      - name: Connect Cloud Phone
        run: |
          bash scripts/adb-connect.sh

      - name: Gather Device Stats
        run: |
          mkdir -p logs
          # RAM in KB
          RAM=$(adb shell cat /proc/meminfo | grep MemTotal | awk '{print $2}')
          echo "RAM=$RAM" > logs/device_stats.txt

          # Battery percentage
          BATTERY=$(adb shell dumpsys battery | grep level | awk '{print $2}')
          echo "BATTERY=$BATTERY" >> logs/device_stats.txt

          # CPU Temperature in Celsius
          TEMP=$(adb shell dumpsys thermalservice | grep -m 1 temperature | awk '{print $2}')
          echo "TEMP=$TEMP" >> logs/device_stats.txt

          echo "Device Stats Collected:"
          cat logs/device_stats.txt

      - name: Auto Mode Selection
        run: |
          source logs/device_stats.txt

          if [ "$RAM" -ge 15000000 ] && [ "$BATTERY" -ge 50 ] && [ "$TEMP" -lt 48000 ]; then
            echo "âœ… Condition met for Gaming Mode"
            bash scripts/afkpal-gaming-mode.sh
          elif [ "$RAM" -ge 12000000 ] && [ "$BATTERY" -ge 35 ]; then
            echo "âš¡ Condition met for Performance Boost Mode"
            bash scripts/performance-boost-mode.sh
          elif [ "$BATTERY" -ge 50 ] && [ "$TEMP" -lt 45000 ]; then
            echo "ðŸ”¥ Condition met for Overclock Mode"
            bash scripts/afkpal-overclock-mode.sh
          else
            echo "âš  Defaulting to Performance Boost Mode"
            bash scripts/performance-boost-mode.sh
          fi

      - name: Run AI Prediction
        run: bash scripts/ai-prediction.sh

      - name: Upload Logs & Reports
        uses: actions/upload-artifact@v4
        with:
          name: afkpal-auto-mode-logs
          path: logs/
